<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Social Analytics Hub</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
	  background: linear-gradient(135deg, #6366f1 0%, #4338ca 100%);
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }
    
    .fade-in {
      animation: fadeIn 0.6s ease-out forwards;
    }
    
    .stat-card {
      transition: all 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.15);
    }
    
    .platform-badge {
      transition: all 0.2s ease;
    }
    
    .platform-badge:hover {
      transform: scale(1.05);
    }
    
    .loading-spinner {
      animation: spin 1s linear infinite;
    }
    
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 1000px 100%;
      animation: shimmer 2s infinite;
    }
    
    .live-indicator {
      position: relative;
      display: inline-block;
    }
    
    .live-indicator::before {
      content: '';
      position: absolute;
      top: 50%;
      left: -12px;
      width: 8px;
      height: 8px;
      background: #ef4444;
      border-radius: 50%;
      transform: translateY(-50%);
      animation: pulse 2s ease-in-out infinite;
    }
    
    .demo-banner {
      background: linear-gradient(90deg, #fbbf24, #f59e0b, #fbbf24);
      background-size: 200% 100%;
      animation: shimmer 3s linear infinite;
    }
	
	button#analyze-btn{
	background: #3b82f6;  /* Bright Blue */
color: #ffffff;       /* White text */
	}
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app-container" class="w-full h-full overflow-auto">
   <div id="input-screen" class="min-h-full flex items-center justify-center p-8">
    <div class="max-w-2xl w-full text-center">
     <div class="mb-8">
      <h1 id="main-title" class="text-5xl font-bold mb-4 text-white">Social Analytics Hub</h1>
      <p id="subtitle" class="text-xl opacity-90 text-white">Get real-time insights and content suggestions for your social media channels</p>
     </div>
     <div class="bg-white rounded-2xl shadow-xl p-8">
      <div class="demo-banner text-white font-bold py-3 px-4 rounded-lg mb-6"><span id="demo-notice">‚ö†Ô∏è DEMO MODE: Real API integration requires authentication credentials</span>
      </div>
      <form id="link-form" class="space-y-6">
       <div><label for="channel-link" class="block text-left text-sm font-semibold mb-2">Channel or Page URL</label> <input type="url" id="channel-link" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition-colors" required>
       </div><button type="submit" id="analyze-btn" class="w-full py-4 rounded-lg font-semibold text-lg transition-all hover:shadow-lg"> Analyze Channel </button>
      </form>
      <div class="mt-6 flex flex-wrap justify-center gap-3"><span class="platform-badge px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-full text-sm font-semibold">üì∏ Instagram</span> <span class="platform-badge px-4 py-2 bg-red-600 text-white rounded-full text-sm font-semibold">‚ñ∂Ô∏è YouTube</span> <span class="platform-badge px-4 py-2 bg-blue-600 text-white rounded-full text-sm font-semibold">üìò Facebook</span> <span class="platform-badge px-4 py-2 bg-sky-500 text-white rounded-full text-sm font-semibold">üê¶ Twitter</span>
      </div>
     </div>
    </div>
   </div>
   <div id="loading-screen" class="hidden min-h-full flex items-center justify-center p-8">
    <div class="text-center">
     <div class="loading-spinner inline-block w-16 h-16 border-4 border-white border-t-transparent rounded-full mb-4"></div>
     <h2 class="text-2xl font-bold text-white mb-2">Fetching Real-Time Data...</h2>
     <p class="text-white opacity-90" id="loading-status">Connecting to platform API...</p>
    </div>
   </div>
   <div id="analytics-screen" class="hidden min-h-full p-8">
    <div class="max-w-7xl mx-auto">
     <div class="flex justify-between items-center mb-8 text-white">
      <div>
       <h2 class="text-3xl font-bold mb-2"><span class="live-indicator">LIVE</span> <span id="channel-name"></span></h2>
       <p id="channel-url" class="opacity-75 text-sm"></p>
       <p class="text-sm opacity-60 mt-1">Last updated: <span id="last-updated">Just now</span></p>
      </div><button id="back-btn" class="px-6 py-3 rounded-lg font-semibold transition-all hover:shadow-lg"> ‚Üê Analyze Another </button>
     </div>
     <div id="platform-badge-container" class="mb-6"></div>
     <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <div class="stat-card bg-white rounded-xl shadow-lg p-6 fade-in" style="animation-delay: 0.1s">
       <div class="text-4xl mb-2">
        üë•
       </div>
       <div class="text-3xl font-bold mb-1" id="followers-count">
        0
       </div>
       <div class="text-sm opacity-75">
        Followers
       </div>
       <div class="text-xs mt-2 font-semibold" id="followers-change">
        +0 today
       </div>
      </div>
      <div class="stat-card bg-white rounded-xl shadow-lg p-6 fade-in" style="animation-delay: 0.2s">
       <div class="text-4xl mb-2">
        ‚ù§Ô∏è
       </div>
       <div class="text-3xl font-bold mb-1" id="engagement-rate">
        0%
       </div>
       <div class="text-sm opacity-75">
        Avg. Engagement
       </div>
       <div class="text-xs mt-2 font-semibold" id="engagement-change">
        +0% vs last week
       </div>
      </div>
      <div class="stat-card bg-white rounded-xl shadow-lg p-6 fade-in" style="animation-delay: 0.3s">
       <div class="text-4xl mb-2">
        üìä
       </div>
       <div class="text-3xl font-bold mb-1" id="posts-count">
        0
       </div>
       <div class="text-sm opacity-75">
        Total Posts
       </div>
       <div class="text-xs mt-2 font-semibold" id="posts-change">
        +0 this month
       </div>
      </div>
      <div class="stat-card bg-white rounded-xl shadow-lg p-6 fade-in" style="animation-delay: 0.4s">
       <div class="text-4xl mb-2">
        üî•
       </div>
       <div class="text-3xl font-bold mb-1" id="growth-rate">
        0%
       </div>
       <div class="text-sm opacity-75">
        Monthly Growth
       </div>
       <div class="text-xs mt-2 font-semibold" id="growth-change">
        +0% vs last month
       </div>
      </div>
     </div>
     <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      <div class="bg-white rounded-xl shadow-lg p-6 fade-in" style="animation-delay: 0.5s">
       <h3 class="text-xl font-bold mb-4">üìà Real-Time Engagement</h3>
       <div class="space-y-4">
        <div>
         <div class="flex justify-between mb-2"><span class="font-semibold">Likes</span> <span id="likes-percent">0%</span>
         </div>
         <div class="w-full bg-gray-200 rounded-full h-3">
          <div id="likes-bar" class="h-3 rounded-full transition-all duration-1000" style="width: 0%"></div>
         </div>
        </div>
        <div>
         <div class="flex justify-between mb-2"><span class="font-semibold">Comments</span> <span id="comments-percent">0%</span>
         </div>
         <div class="w-full bg-gray-200 rounded-full h-3">
          <div id="comments-bar" class="h-3 rounded-full transition-all duration-1000" style="width: 0%"></div>
         </div>
        </div>
        <div>
         <div class="flex justify-between mb-2"><span class="font-semibold">Shares</span> <span id="shares-percent">0%</span>
         </div>
         <div class="w-full bg-gray-200 rounded-full h-3">
          <div id="shares-bar" class="h-3 rounded-full transition-all duration-1000" style="width: 0%"></div>
         </div>
        </div>
       </div>
       <div class="mt-4 pt-4 border-t text-sm text-center opacity-75">
        Auto-refreshing every 30 seconds
       </div>
      </div>
      <div class="bg-white rounded-xl shadow-lg p-6 fade-in" style="animation-delay: 0.6s">
       <h3 class="text-xl font-bold mb-4">‚è∞ Best Posting Times</h3>
       <div class="space-y-3">
        <div class="flex items-center justify-between p-3 rounded-lg" id="time-slot-1"><span class="font-semibold">üåÖ Morning (8-10 AM)</span> <span class="px-3 py-1 rounded-full text-sm font-bold">High</span>
        </div>
        <div class="flex items-center justify-between p-3 rounded-lg" id="time-slot-2"><span class="font-semibold">‚òÄÔ∏è Afternoon (2-4 PM)</span> <span class="px-3 py-1 rounded-full text-sm font-bold">Medium</span>
        </div>
        <div class="flex items-center justify-between p-3 rounded-lg" id="time-slot-3"><span class="font-semibold">üåô Evening (7-9 PM)</span> <span class="px-3 py-1 rounded-full text-sm font-bold">High</span>
        </div>
       </div>
      </div>
     </div>
     <div class="bg-white rounded-xl shadow-lg p-6 fade-in" style="animation-delay: 0.7s">
      <h3 class="text-xl font-bold mb-4">üí° AI-Powered Content Suggestions</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="suggestions-container"></div>
     </div>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      page_title: "Social Analytics Hub",
      page_subtitle: "Get real-time insights and content suggestions for your social media channels",
      input_placeholder: "Paste your Instagram, YouTube, Facebook, or Twitter URL",
      analyze_button: "Analyze Channel",
      demo_notice: "‚ö†Ô∏è DEMO MODE: Real API integration requires authentication credentials",
      background_color: "#6366f1",
      surface_color: "#ffffff",
      text_color: "#1f2937",
      primary_action_color: "#3b82f6",
      secondary_action_color: "#8b5cf6"
    };

    let refreshInterval = null;
    let currentUrl = '';

    const element = {
      defaultConfig,
      
      onConfigChange: async (config) => {
        const bgColor = config.background_color || defaultConfig.background_color;
        const surfaceColor = config.surface_color || defaultConfig.surface_color;
        const textColor = config.text_color || defaultConfig.text_color;
        const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
        const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;
        const customFont = config.font_family || defaultConfig.font_family;
        const baseSize = config.font_size || defaultConfig.font_size || 16;
        
        const fontStack = customFont ? `${customFont}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif` : `-apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`;
        
        document.body.style.fontFamily = fontStack;
        document.body.style.fontSize = `${baseSize}px`;
        
        const inputScreen = document.getElementById('input-screen');
        const analyticsScreen = document.getElementById('analytics-screen');
        const loadingScreen = document.getElementById('loading-screen');
        inputScreen.style.background = `linear-gradient(135deg, ${bgColor} 0%, ${adjustBrightness(bgColor, -20)} 100%)`;
        analyticsScreen.style.background = `linear-gradient(135deg, ${adjustBrightness(bgColor, 30)} 0%, ${adjustBrightness(bgColor, 10)} 100%)`;
        loadingScreen.style.background = `linear-gradient(135deg, ${bgColor} 0%, ${adjustBrightness(bgColor, -20)} 100%)`;
        
        document.getElementById('main-title').textContent = config.page_title || defaultConfig.page_title;
        document.getElementById('main-title').style.color = surfaceColor;
        document.getElementById('main-title').style.fontSize = `${baseSize * 2.5}px`;
        
        document.getElementById('subtitle').textContent = config.page_subtitle || defaultConfig.page_subtitle;
        document.getElementById('subtitle').style.color = surfaceColor;
        document.getElementById('subtitle').style.fontSize = `${baseSize * 1.25}px`;
        
        document.getElementById('demo-notice').textContent = config.demo_notice || defaultConfig.demo_notice;
        
        const inputLabel = document.querySelector('label[for="channel-link"]');
        inputLabel.style.color = textColor;
        inputLabel.style.fontSize = `${baseSize * 0.875}px`;
        
        const inputField = document.getElementById('channel-link');
        inputField.placeholder = config.input_placeholder || defaultConfig.input_placeholder;
        inputField.style.fontSize = `${baseSize}px`;
        inputField.style.borderColor = adjustBrightness(primaryColor, 20);
        inputField.style.color = textColor;
        
        const analyzeBtn = document.getElementById('analyze-btn');
        analyzeBtn.textContent = config.analyze_button || defaultConfig.analyze_button;
        analyzeBtn.style.background = primaryColor;
        analyzeBtn.style.color = surfaceColor;
        analyzeBtn.style.fontSize = `${baseSize * 1.125}px`;
        
        const backBtn = document.getElementById('back-btn');
        backBtn.style.background = secondaryColor;
        backBtn.style.color = surfaceColor;
        backBtn.style.fontSize = `${baseSize}px`;
        
        document.querySelectorAll('.stat-card').forEach(card => {
          card.style.background = surfaceColor;
          card.style.color = textColor;
          const value = card.querySelector('div:nth-child(2)');
          if (value) value.style.fontSize = `${baseSize * 1.875}px`;
          const label = card.querySelector('div:nth-child(3)');
          if (label) label.style.fontSize = `${baseSize * 0.875}px`;
        });
        
        document.querySelectorAll('.fade-in').forEach(el => {
          el.style.background = surfaceColor;
          el.style.color = textColor;
        });
        
        document.querySelectorAll('.fade-in h3').forEach(heading => {
          heading.style.fontSize = `${baseSize * 1.25}px`;
          heading.style.color = textColor;
        });
        
        const bars = ['likes-bar', 'comments-bar', 'shares-bar'];
        bars.forEach(barId => {
          document.getElementById(barId).style.background = primaryColor;
        });
        
        document.querySelectorAll('[id^="time-slot-"]').forEach(slot => {
          slot.style.background = adjustBrightness(surfaceColor, -5);
          const badge = slot.querySelector('span:last-child');
          badge.style.background = secondaryColor;
          badge.style.color = surfaceColor;
        });
      },
      
      mapToCapabilities: (config) => ({
        recolorables: [
          {
            get: () => config.background_color || defaultConfig.background_color,
            set: (value) => {
              if (window.elementSdk) {
                window.elementSdk.setConfig({ background_color: value });
              }
            }
          },
          {
            get: () => config.surface_color || defaultConfig.surface_color,
            set: (value) => {
              if (window.elementSdk) {
                window.elementSdk.setConfig({ surface_color: value });
              }
            }
          },
          {
            get: () => config.text_color || defaultConfig.text_color,
            set: (value) => {
              if (window.elementSdk) {
                window.elementSdk.setConfig({ text_color: value });
              }
            }
          },
          {
            get: () => config.primary_action_color || defaultConfig.primary_action_color,
            set: (value) => {
              if (window.elementSdk) {
                window.elementSdk.setConfig({ primary_action_color: value });
              }
            }
          },
          {
            get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
            set: (value) => {
              if (window.elementSdk) {
                window.elementSdk.setConfig({ secondary_action_color: value });
              }
            }
          }
        ],
        borderables: [],
        fontEditable: {
          get: () => config.font_family || defaultConfig.font_family,
          set: (value) => {
            if (window.elementSdk) {
              window.elementSdk.setConfig({ font_family: value });
            }
          }
        },
        fontSizeable: {
          get: () => config.font_size || defaultConfig.font_size || 16,
          set: (value) => {
            if (window.elementSdk) {
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }
      }),
      
      mapToEditPanelValues: (config) => new Map([
        ["page_title", config.page_title || defaultConfig.page_title],
        ["page_subtitle", config.page_subtitle || defaultConfig.page_subtitle],
        ["input_placeholder", config.input_placeholder || defaultConfig.input_placeholder],
        ["analyze_button", config.analyze_button || defaultConfig.analyze_button],
        ["demo_notice", config.demo_notice || defaultConfig.demo_notice]
      ])
    };

    function adjustBrightness(hex, percent) {
      const num = parseInt(hex.replace('#', ''), 16);
      const r = Math.min(255, Math.max(0, (num >> 16) + percent));
      const g = Math.min(255, Math.max(0, ((num >> 8) & 0x00FF) + percent));
      const b = Math.min(255, Math.max(0, (num & 0x0000FF) + percent));
      return `#${((r << 16) | (g << 8) | b).toString(16).padStart(6, '0')}`;
    }

    function extractChannelName(url) {
      try {
        const urlObj = new URL(url);
        const pathname = urlObj.pathname;
        
        // Extract username/channel name from path
        const parts = pathname.split('/').filter(p => p.length > 0);
        
        if (parts.length > 0) {
          // Get the first meaningful part (usually username/channel)
          let channelName = parts[0];
          
          // Clean up common prefixes
          if (channelName === 'c' || channelName === 'channel' || channelName === 'user') {
            channelName = parts[1] || parts[0];
          }
          
          // Remove @ symbol if present
          channelName = channelName.replace('@', '');
          
          // Capitalize first letter of each word
          return channelName
            .split(/[-_.]/)
            .map(word => word.charAt(0).toUpperCase() + word.slice(1))
            .join(' ');
        }
      } catch (e) {
        // If URL parsing fails, try to extract anything that looks like a username
        const match = url.match(/[@\/]([a-zA-Z0-9_.-]+)/);
        if (match) {
          return match[1]
            .split(/[-_.]/)
            .map(word => word.charAt(0).toUpperCase() + word.slice(1))
            .join(' ');
        }
      }
      
      return 'Unknown Channel';
    }

    function detectPlatform(url) {
      const urlLower = url.toLowerCase();
      if (urlLower.includes('instagram.com') || urlLower.includes('instagr.am')) {
        return { name: 'Instagram', emoji: 'üì∏', color: 'from-purple-500 to-pink-500' };
      } else if (urlLower.includes('youtube.com') || urlLower.includes('youtu.be')) {
        return { name: 'YouTube', emoji: '‚ñ∂Ô∏è', color: 'from-red-600 to-red-700' };
      } else if (urlLower.includes('facebook.com') || urlLower.includes('fb.com')) {
        return { name: 'Facebook', emoji: 'üìò', color: 'from-blue-600 to-blue-700' };
      } else if (urlLower.includes('twitter.com') || urlLower.includes('x.com')) {
        return { name: 'Twitter', emoji: 'üê¶', color: 'from-sky-500 to-sky-600' };
      } else {
        return { name: 'Social Media', emoji: 'üåê', color: 'from-gray-500 to-gray-600' };
      }
    }

    async function fetchRealTimeData(platform) {
      // Simulate API delay
      await new Promise(resolve => setTimeout(resolve, 1500));
      
      // Generate realistic fluctuating data
      const baseFollowers = Math.floor(Math.random() * 50000) + 10000;
      const todayChange = Math.floor(Math.random() * 200) + 50;
      const baseEngagement = (Math.random() * 8 + 2).toFixed(1);
      const engagementChange = (Math.random() * 2 - 1).toFixed(1);
      const basePosts = Math.floor(Math.random() * 500) + 100;
      const monthPosts = Math.floor(Math.random() * 20) + 5;
      const baseGrowth = (Math.random() * 15 + 2).toFixed(1);
      const growthChange = (Math.random() * 3 - 1).toFixed(1);
      
      const likesPercent = Math.floor(Math.random() * 30) + 50;
      const commentsPercent = Math.floor(Math.random() * 15) + 15;
      const sharesPercent = 100 - likesPercent - commentsPercent;
      
      return {
        followers: baseFollowers.toLocaleString(),
        followersChange: `+${todayChange} today`,
        engagement: `${baseEngagement}%`,
        engagementChange: `${engagementChange > 0 ? '+' : ''}${engagementChange}% vs last week`,
        posts: basePosts.toLocaleString(),
        postsChange: `+${monthPosts} this month`,
        growth: `+${baseGrowth}%`,
        growthChange: `${growthChange > 0 ? '+' : ''}${growthChange}% vs last month`,
        breakdown: {
          likes: likesPercent,
          comments: commentsPercent,
          shares: sharesPercent
        }
      };
    }

    function generateSuggestions(platform) {
      const suggestions = [
        { icon: 'üé•', title: 'Video Content', desc: 'Short-form videos are getting 3x more engagement', color: '#ef4444' },
        { icon: 'üìÖ', title: 'Consistent Posting', desc: 'Post 4-5 times per week for optimal growth', color: '#10b981' },
        { icon: 'üí¨', title: 'Engage with Comments', desc: 'Respond within 1 hour to boost algorithm favor', color: '#3b82f6' },
        { icon: 'üé®', title: 'Visual Quality', desc: 'High-quality images increase saves by 40%', color: '#8b5cf6' },
        { icon: 'üîñ', title: 'Use Hashtags', desc: 'Mix 3-5 niche and trending hashtags', color: '#f59e0b' },
        { icon: 'üìä', title: 'Track Analytics', desc: 'Monitor which content performs best weekly', color: '#06b6d4' },
        { icon: 'üåü', title: 'Story Highlights', desc: 'Keep important stories saved in highlights', color: '#ec4899' },
        { icon: 'ü§ù', title: 'Collaborate', desc: 'Partner with similar creators for cross-promotion', color: '#14b8a6' }
      ];
      
      return suggestions.sort(() => 0.5 - Math.random()).slice(0, 4);
    }

    async function updateAnalytics(url) {
      const platform = detectPlatform(url);
      
      const loadingMessages = [
        'Connecting to platform API...',
        'Authenticating request...',
        'Fetching follower data...',
        'Analyzing engagement metrics...',
        'Processing real-time insights...'
      ];
      
      let messageIndex = 0;
      const messageInterval = setInterval(() => {
        if (messageIndex < loadingMessages.length) {
          document.getElementById('loading-status').textContent = loadingMessages[messageIndex];
          messageIndex++;
        }
      }, 400);
      
      const analytics = await fetchRealTimeData(platform.name);
      clearInterval(messageInterval);
      
      document.getElementById('followers-count').textContent = analytics.followers;
      document.getElementById('followers-change').textContent = analytics.followersChange;
      document.getElementById('followers-change').style.color = '#10b981';
      
      document.getElementById('engagement-rate').textContent = analytics.engagement;
      document.getElementById('engagement-change').textContent = analytics.engagementChange;
      document.getElementById('engagement-change').style.color = analytics.engagementChange.startsWith('+') ? '#10b981' : '#ef4444';
      
      document.getElementById('posts-count').textContent = analytics.posts;
      document.getElementById('posts-change').textContent = analytics.postsChange;
      document.getElementById('posts-change').style.color = '#10b981';
      
      document.getElementById('growth-rate').textContent = analytics.growth;
      document.getElementById('growth-change').textContent = analytics.growthChange;
      document.getElementById('growth-change').style.color = analytics.growthChange.startsWith('+') ? '#10b981' : '#ef4444';
      
      document.getElementById('likes-percent').textContent = `${analytics.breakdown.likes}%`;
      document.getElementById('likes-bar').style.width = `${analytics.breakdown.likes}%`;
      
      document.getElementById('comments-percent').textContent = `${analytics.breakdown.comments}%`;
      document.getElementById('comments-bar').style.width = `${analytics.breakdown.comments}%`;
      
      document.getElementById('shares-percent').textContent = `${analytics.breakdown.shares}%`;
      document.getElementById('shares-bar').style.width = `${analytics.breakdown.shares}%`;
      
      const now = new Date();
      document.getElementById('last-updated').textContent = now.toLocaleTimeString();
    }

    async function showAnalytics(url) {
      currentUrl = url;
      const platform = detectPlatform(url);
      const suggestions = generateSuggestions(platform.name);
      
      document.getElementById('input-screen').classList.add('hidden');
      document.getElementById('loading-screen').classList.remove('hidden');
      
      const analytics = await fetchRealTimeData(platform.name);
      
      document.getElementById('loading-screen').classList.add('hidden');
      document.getElementById('analytics-screen').classList.remove('hidden');
      
      const channelName = extractChannelName(url);
      document.getElementById('channel-name').textContent = channelName;
      document.getElementById('channel-url').textContent = url;
      
      const badgeContainer = document.getElementById('platform-badge-container');
      badgeContainer.innerHTML = `
        <div class="inline-block px-6 py-3 bg-gradient-to-r ${platform.color} text-white rounded-full text-lg font-bold shadow-lg">
          ${platform.emoji} ${platform.name}
        </div>
      `;
      
      setTimeout(() => {
        document.getElementById('followers-count').textContent = analytics.followers;
        document.getElementById('followers-change').textContent = analytics.followersChange;
        document.getElementById('followers-change').style.color = '#10b981';
        
        document.getElementById('engagement-rate').textContent = analytics.engagement;
        document.getElementById('engagement-change').textContent = analytics.engagementChange;
        document.getElementById('engagement-change').style.color = analytics.engagementChange.startsWith('+') ? '#10b981' : '#ef4444';
        
        document.getElementById('posts-count').textContent = analytics.posts;
        document.getElementById('posts-change').textContent = analytics.postsChange;
        document.getElementById('posts-change').style.color = '#10b981';
        
        document.getElementById('growth-rate').textContent = analytics.growth;
        document.getElementById('growth-change').textContent = analytics.growthChange;
        document.getElementById('growth-change').style.color = analytics.growthChange.startsWith('+') ? '#10b981' : '#ef4444';
      }, 300);
      
      setTimeout(() => {
        document.getElementById('likes-percent').textContent = `${analytics.breakdown.likes}%`;
        document.getElementById('likes-bar').style.width = `${analytics.breakdown.likes}%`;
        
        document.getElementById('comments-percent').textContent = `${analytics.breakdown.comments}%`;
        document.getElementById('comments-bar').style.width = `${analytics.breakdown.comments}%`;
        
        document.getElementById('shares-percent').textContent = `${analytics.breakdown.shares}%`;
        document.getElementById('shares-bar').style.width = `${analytics.breakdown.shares}%`;
      }, 800);
      
      const suggestionsContainer = document.getElementById('suggestions-container');
      suggestionsContainer.innerHTML = suggestions.map(s => `
        <div class="p-4 rounded-lg border-l-4 hover:shadow-md transition-shadow" style="border-color: ${s.color}">
          <div class="flex items-start gap-3">
            <span class="text-2xl">${s.icon}</span>
            <div>
              <h4 class="font-bold mb-1">${s.title}</h4>
              <p class="text-sm opacity-75">${s.desc}</p>
            </div>
          </div>
        </div>
      `).join('');
      
      // Start auto-refresh every 30 seconds
      if (refreshInterval) {
        clearInterval(refreshInterval);
      }
      refreshInterval = setInterval(() => {
        updateAnalytics(currentUrl);
      }, 30000);
    }

    document.getElementById('link-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const url = document.getElementById('channel-link').value;
      if (url) {
        showAnalytics(url);
      }
    });

    document.getElementById('back-btn').addEventListener('click', () => {
      if (refreshInterval) {
        clearInterval(refreshInterval);
        refreshInterval = null;
      }
      document.getElementById('analytics-screen').classList.add('hidden');
      document.getElementById('input-screen').classList.remove('hidden');
      document.getElementById('channel-link').value = '';
      currentUrl = '';
    });

    if (window.elementSdk) {
      window.elementSdk.init(element);
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b90ff1062a045af',t:'MTc2NzU5NTM1NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
